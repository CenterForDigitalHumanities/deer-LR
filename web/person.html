<!DOCTYPE html>
<!--
    author: Bryan Haberberger <bryan.j.haberberger@slu.edu>
    @author: cubap@slu.edu
    -->
<html>

<head>
    <title>Person</title>
    <link rel="shortcut icon" type="image/x-icon" href="./images/favicon/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/lr.css">
</head>

<body>
    <lr-nav>
        <div class="nav-left">
            <a class="brand" href="index.html"><img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Meuble_h%C3%A9raldique_Fleur_de_lis.svg"></a>
            <div class="tabs">
                <a href="places.html">Locations</a>
                <a href="objects.html">Objects</a>
                <a href="people.html">People</a>
                <a href="organizations.html">Organizations</a>
                <a href="map.html">Map View</a>
            </div>
        </div>
    </lr-nav>
    <lr-field-notes></lr-field-notes>
    <div class="container">
        <h2 class="text-primary">Create a New Person</h2>
        <div class="card bd-primary">
            <div class="card_body">
                <form id="personForm" class="hidden" deer-type="Person" deer-creator deer-motivation="supplementing" deer-context="http://lived-religion.rerum.io/deer-lr/vocab/context.json">
                    <input type="hidden" deer-key="creator" value="loading">
                    <input type="hidden" deer-key="targetCollection" value="LivedReligionPeople">
                    <input type="hidden" deer-key="fieldNotes" />
                    <h4 class="text-primary">Contact Details</h4>
                    <div class="grouped">
                        <label>Name</label>
                        <input type="text" deer-key="name">
                        <label>Birth Date</label>
                        <input type="date" deer-key="birthDate">
                    </div>
                    <div class="grouped">
                        <label>E‑mail</label>
                        <input type="text" deer-key="email">
                        <label>Phone Number</label>
                        <input type="text" deer-key="telephone">
                    </div>
                    <label>Address</label>
                    <textarea type="text" deer-key="address"></textarea>
                    <h4 class="text-primary">General Details</h4>
                    <div class="row">
                        <div class="traditionWrapper col">
                            <label>Religious Tradition</label>
                            <select deer-key="religiousTradition">
                                <option disabled selected value> Not Supplied </option>
                                <optgroup label="Christian">
                                    <option value="Evangelical Protestant">Evangelical Protestant</option>
                                    <option value="Mainline Protestant">Mainline Protestant</option>
                                    <option value="Historically Black Protestant">Historically Black Protestant</option>
                                    <option value="Catholic">Catholic</option>
                                    <option value="Mormon">Mormon</option>
                                    <option value="Othodox Christian">Orthodox Christian</option>
                                    <option value="Jehova's Witness">Jehovah’s Witness</option>
                                    <option value="Other Christian">Other Christian</option>
                                </optgroup>
                                <optgroup label="Jewish">
                                    <option value="Conservative">Conservative</option>
                                    <option value="Reform">Reform</option>
                                    <option value="Orthodox">Orthodox</option>
                                    <option value="Reconstructionist">Reconstructionist</option>
                                    <option value="Other">Other</option>
                                </optgroup>
                                <option value="Muslim">Muslim</option>
                                <option value="Buddhist">Buddhist</option>
                                <option value="Daoist">Daoist</option>
                                <option value="Confucianism">Confucianism</option>
                                <option value="Hindu">Hindu</option>
                                <option value="Sikh">Sikh</option>
                                <option value="Pagan">Pagan</option>
                                <option value="Indigenous">Indigenous</option>
                                <option value="Native American Traditions">Native American Traditions</option>
                                <option value="Other Religions">Other Religions</option>
                                <option value="Other Faiths">Other Faiths</option>
                                <option value="Unaffiliated">Unaffiliated</option>
                                <option value="Atheist">Atheist</option>
                                <option value="Agnostic">Agnostic</option>
                                <option value="Humanist">Humanist</option>
                                <option value="Nothing in particular">Nothing in particular</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Race/Ethnicity</label>
                            <select deer-key="ethnicity">
                                <option disabled selected value> Not Supplied </option>
                                <option value="African American/Black/African">African American/Black/African</option>
                                <option value="Bosniak">Bosniak</option>
                                <option value="Caribbean">Caribbean</option>
                                <option value="East Asian">East Asian</option>
                                <option value="Hispanic/Latin">Hispanic/Latin</option>
                                <option value="Middle Eastern">Middle Eastern</option>
                                <option value="Bosniak">Native American/indigenous American</option>
                                <option value="Native American/indigenous American">North African/Mediterranean</option>
                                <option value="Pacific Islander">Pacific Islander</option>
                                <option value="South Asian">South Asian</option>
                                <option value="Mixed-Race">Mixed-race</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Gender & Sexuality</label>
                            <select deer-key="gender">
                                <option disabled selected value> Not Supplied </option>
                                <option value="Female-presenting">Female-presenting</option>
                                <option value="Male-presenting">Male-presenting</option>
                                <option value="Mostly cisgender mixed">Mostly cisgender mixed</option>
                                <option value="Mostly transgender or queer">Mostly transgender or queer</option>
                                <option value="Mix of transgender, queer, and cisgender">Mix of transgender, queer, and cisgender</option>
                                <option value="Genders are intermingled">Genders are intermingled</option>
                                <option value="Genders are separated">Genders are separated</option>
                                <option value="Other">Other</option>
                                <option value="Not applicable">Not applicable</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Education</label>
                            <select deer-key="education">
                                <option disabled selected value> Not Supplied </option>
                                <option value="Some high school">Some high school</option>
                                <option value="High school graduate">High school graduate</option>
                                <option value="Some college">Some college</option>
                                <option value="College Degree">College degree</option>
                                <option value="Post-baccalaureate degree">Post-baccalaureate degree</option>
                            </select>
                        </div>
                    </div>
                    <label>National Origin</label>
                    <input type="text" deer-key="nationality">
                    <h4 class="text-primary">Media</h4>
                    <div class="card bg-light" style="margin-top: 3px;">
                        <header class="text-primary">Upload New Media</header>
                        <div class="card_body">
                            <p class="text-primary">
                                <small>
                                    Upload new media or supply an URI to existing media to associate with this person.
                                    Even though your files are uploaded and URIs appear in the media you still <b>MUST click Save or Update</b> 
                                    at the bottom of this form for the URIs to be saved to this person.
                                </small>
                            </p>
                            <lr-media-upload media-key="associatedMedia"> </lr-media-upload>
                            <ul media-key="associatedMedia" class="connectedMedia"></ul>
                        </div>
                    </div>

                    <div class="card bg-light" style="margin-top: 3px;">
                        <header class="text-primary">Set Top Level Media</header>
                        <div class="card_body">
                            <p class="text-primary">
                                <small>
                                    Link singular pieces of media that should always be present in views for this experience.
                                </small>
                            </p>
                            <label>Link a photograph or depiction: </label>
                            <input type="url" deer-key="image" id="depiction">
                            <div media-key="image"></div>
                            <label>Link audio: </label>
                            <input type="url" deer-key="audio" >
                            <div media-key="audio"></div>
                            <label>Link a video: </label>
                            <input type="url" deer-key="video" >
                            <div media-key="video"></div>
                        </div>
                    </div>
                    <h4 class="text-primary">Additional Details</h4>
                    <label title="Provide a short decription of this person with otherwise unprovided or disambiguating details.">Brief Description</label>
                    <textarea  title="Provide a short decription of this person with otherwise unprovided or disambiguating details." deer-key="description"></textarea>
                    <label title="Provide any general notes in relation to this person.">Notes</label>
                    <textarea type="text" title="Provide any general notes in relation to this person." deer-key="notes"></textarea>
                    <footer>
                        <input class="button primary" type="submit">
                    </footer>
                </form>
            </div>
        </div>
    </div>
    <div class="pageShade is-hidden"></div>
    <lr-global-feedback></lr-global-feedback>
    <lr-footer></lr-footer>
    
    <script src="./js/sysendBroadcaster.js" type="text/javascript"></script>
    <script>
        /**
        * Catch user detection and trigger draw() for interfaces.
        */
        addEventListener('lrUserKnown', event => {
            LR.utils.drawInterface(event, "person")
        })

        addEventListener('deer-updated', event => {
            LR.ui.globalFeedbackBlip(event, `Saving '${event.detail.name}' successful!`, true)
        })
        
        /**
         * A hack to force redraw by refreshing the page.
         */
        addEventListener('globalFeedbackFinished', event => {
            window.location = document.referrer
        })   
        
        /**
         * Detects that all annotation data is gathered and all HTML of the form is in the DOM and can be interacted with.
         * This is important for pre-filling or pre-selecting values of multi select areas, dropdown, checkboxes, etc. 
         * This event will come after all deer-view-rendered events have finished.
         * @see deer-record.js DeerReport.constructor()  
         */
        addEventListener('deer-form-rendered', event => {
            let whatRecordForm = event.target.id
            let annotationData = event.detail
            switch (whatRecordForm) {
                case "personForm":
                    LR.utils.prePopulateFieldNotes(annotationData.fieldNotes)
                    LR.media.showConnectedMedia(annotationData, ["image", "audio", "video", "associatedMedia"], event.target)
                    break
                default:

            }
        })
        
        /**
         * Do a thumbnail preview when a user links a depiction
         * @type {type}
         */
        depiction.addEventListener("input",event=>{
            let url = event.target.value
            if(url) {
                try {
                    fetch(url).then(res=>{
                        depictionPreview.innerHTML = `<img style="max-height:20rem;" src="${url}">`
                    })
                } catch(err){
                    depictionPreview.innerHTML = ``
                }
            } else {
                depictionPreview.innerHTML = ``
            }
        })
        
        /**
         * Handle Login and Logout across tabs
         */
        local_socket.on('loginError', function(obj) {
            alert("There was a problem logging in.  Check the username and password.  If this problem persist, contact the administrator to reset your username and/or password.")
        })

        local_socket.on('loginFinished', function(obj) {
            //Perhaps it could be more elegant to dispatch the lrUserKnown event.  Socket events are not caught on the page they are generated...
            //Reload does everything we want inside the framework we already built in <lr-login> elements
            document.location.reload()
        })

        local_socket.on('logoutError', function(obj) {
            alert("There was a problem logging out.  Refresh the page and try again.")
        })

        local_socket.on('logoutFinished', function(obj) {
            //obj.fn() would be neat if obj.fn = function(){return LR.utils.logout()} would work...see logout.html
            document.location.href="dashboard.html"
        })
    </script>
    <script src="./js/deerInitializer.js" type="module"></script>
    <script src="./js/app.js" type="text/javascript"></script>
    <script src="./js/components.js" type="text/javascript"></script>

</body>

</html>
